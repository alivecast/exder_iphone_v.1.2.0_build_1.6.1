<!DOCTYPE html>
<html>
	<head>
		<title></title>

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta charset="utf-8">

		<link rel="stylesheet" href="js/jquery.mobile-1.2.0.min.css" type="text/css" />
		<link rel="stylesheet" href="css/iphone.css" type="text/css" />
		<link rel="stylesheet" href="css/android.css" type="text/css" />

		<script type="text/javascript" charset="utf-8" src="js/jquery-1.8.2.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/base64.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/aes.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/cordova.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/barcodescanner.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/file.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/main.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/init.js"></script>
		<script src="js/spin.min.js" type="text/javascript"></script>
		<script type="text/javascript" charset="utf-8" src="js/jquery.mobile-1.2.0.min.js"></script>

		<script type="text/javascript">
		
			var storage = {};
		
			$(document).ready(function() {
				document.addEventListener("deviceready", onDeviceReady, false);
			});

			function onDeviceReady() {
				start(onDeviceReady1);
			}
			function onDeviceReady1() {
				// 通信確認
				if (check_network() == 'none') {
					var chSetting = getLocalStorage('chSetting');
					if (chSetting == null || chSetting == '') {
						hrefStorageAll('netError.html', storage);
						//// window.location.href = 'netError.html';
						// ひとまずbarcode画面へ
						onDeviceReady2();
					} else {
						// とりあえず表示だけする
						hrefStorageAll('setting.html', storage);
						// window.location.href = 'setting.html';
					}
				} else {
					// 通信出来る
					onDeviceReady2();
				}
			}

			function onDeviceReady2() {

				// ローディング開始
				$('#loading').css('display', 'block');

				// 表示フラグの取得
				var show_item_flg = getLocalStorage('show_item_flg');
				console.log('show_item_flg: ' + show_item_flg);
				// 表示画面の判定
				if (show_item_flg == 'false') {
					// barcode画面の表示
					startBarcode();
				} else {
					// 商品情報の表示
					showItem();
				}

				// barcode画面
				function startBarcode() {

					// バックボタン設定
					var purchased_item_flg = getLocalStorage('purchased_item_flg');
					var before = getLocalStorage('before');
					setLocalStorage(storage, 'before', 'barcode.html');
					if (purchased_item_flg == '' || show_item_flg == 'false') {
						// 戻るボタン 読み取り前
						before = 'setting.html';
					}

					// qr_id,位置情報の初期化
					var barcodeParams = {
						qr_id: '',
						order_latitude : 0,
						order_longitude : 0
					}

					// 位置情報の初期化
					var latitude = 0;
					var longitude = 0;

					// barcode読み取り
					window.plugins.barcodeScanner.scan(function(result) {
						
						// 商品情報フラグ初期化
						setLocalStorage(storage, 'purchased_item_flg', '');
						
						// キャンセル
						if (result.cancelled) {
							
///////////////////////////////////////////////////////////////////
// シミュレータ用
//result = 'http://exorder.jp/2001010000190000038101';
//scannerSuccess(result);

// 本番用 
hrefStorageAll('setting.html', storage);
///////////////////////////////////////////////////////////////////
							
							// 読み取り成功
						} else {
							// 計測用
							setLocalStorage(storage, 'time', parseInt(new Date().getTime()));
							
							// exorderを含むか判定
							if (result.text.match(/exorder.jp|www.exorder.jp/i)) {
								// オーディオ再生
								var src = 'mp3/decide.mp3';
								var audio = new Media(src, null, null);
								audio.play();
								// 読み取り成功メッソド
								scannerSuccess(result.text);
							} else {
								var message = result.text;
								var title = 'ExOrder でお使いいただけないQRコードです';
								var button = "OK";
								navigator.notification.alert(message, function() {
									hrefStorageAll('setting.html', storage);
									// window.location.href = 'setting.html';
								}, title, button);
							}
						}
					}, function(error) {
						// 読み取りフラグ:商品なし
						setLocalStorage(storage, 'purchased_item_flg', '');
						// 読み取り失敗メソッド
						scannerFailure(error);
					});

					// 位置情報をアプリで使えるか判定
					if (navigator.geolocation) {
						var option = {
							// 出来るだけ良い精度で取得する：時間はかかる
							enableHighAccuracy : false,
							// 取得するまでのタイムアウト時間
							timeout : 500,
							// 位置情報をキャッシュする時間
							maximumAge : 0
						};
						// 位置情報取得メソッド
						navigator.geolocation.getCurrentPosition(onGeoSuccess, onGeoError, option);
					} else {
						// 位置情報取得に失敗メソッド
						onGeoError();
					}
					// 位置情報取得に失敗メソッド
					function onGeoError(error) {
						// 位置情報の格納
						barcodeParams['order_latitude'] = 0;
						barcodeParams['order_longitude'] = 0;
						console.log('位置情報:失敗: ' + JSON.stringify(barcodeParams));
					}

					// 位置情報取得に成功メソッド
					function onGeoSuccess(position) {
						// 位置情報の格納
						barcodeParams['order_latitude'] = position.coords.latitude;
						barcodeParams['order_longitude'] = position.coords.longitude;
						console.log('位置情報:成功: ' + JSON.stringify(barcodeParams));
					}

					// Barcode 読み込み成功　-------------------------------------------------------------
					function scannerSuccess(result) {
						// 計測
						var showTime = parseInt(new Date().getTime()) - parseInt(getLocalStorage('time'));
						console.log('QRコード読み取りから成功メッソド: ' + showTime);
						
						// 読み取りフラグ:購入時の住所入力などで、途中でやめ、商品に戻ってきた場合、読み取り後に変えてあげる。
						setLocalStorage(storage, 'purchased_item_flg', 'get');

						// 通信確認
						if (check_network() == 'none') {
							var chSetting = getLocalStorage('chSetting');
							if (chSetting == null || chSetting == '') {
								hrefStorageAll('netError.html', storage);
								// window.location.href = 'netError.html';
							} else {
								// とりあえず表示だけする
								hrefStorageAll('setting.html', storage);
								// window.location.href = 'setting.html';
							}
						} else {
							// 通信出来る
							scannerSuccess2(result)
						}
					}

					function scannerSuccess2(result) {

						// 以前に商品詳細で変更した注文数量をクリア
						delFile("backAmount");
						// 保存した数量の初期化フラグ true:初期化
						setLocalStorage(storage, 'initBackAmount', 'true');
						// 商品情報の初期化
						setLocalStorage(storage, 'show_item_params', '');
						// 読み取りフラグ:読み取り後
						setLocalStorage(storage, 'purchased_item_flg', 'get');
						// qr_id抽出
						cutProtocole = result.replace(/http:\/\/|https:\/\//, "");
						var qr_id = cutProtocole.replace(/exorder.jp\/|www.exorder.jp\//, "");
						// qr_idを格納
						barcodeParams['qr_id'] = String(qr_id);
						// 商品情報へ
						setLocalStorage(storage, 'barcodeParams', JSON.stringify(barcodeParams));

						showItem();
					}

					// Barcode 読み込み失敗　---------------------------------------------------------------
					function scannerFailure(message) {
						var message = 'もう一度QRコードを撮影してください';
						var title = 'QRコードの読み取りに失敗しました';
						var button = 'OK';
						navigator.notification.alert(message, function() {
							hrefStorageAll('setting.html', storage);
							// window.location.href = 'barcode.html';
						}, title, button);
					}

				}

				// 商品情報の表示
				function showItem() {
					
					setLocalStorage(storage, 'show_item_flg', 'true');
					
					// 計測
					showTime = parseInt(new Date().getTime()) - parseInt(getLocalStorage('time'));
					console.log('QRコード読み取りからshowItem: ' + showTime);

					// 購入不可メッセージを非表示
					$('#notSalesMsg').css('display', 'none');

					// ajax タイムアウト設定
					$.ajaxSetup({
						timeout : 3000
					});

					// メニューボタン設定 (fixedToolbarsの画面タップによる表示非表示を抑制）
					$("[data-role=header]").fixedtoolbar({
						tapToggle : false
					});
					$('#nav').css('display', 'block');

					// 商品情報の取得方法を判定
					// サーバからの商品情報の保存ハッシュ
					var paramsText = getLocalStorage('show_item_params');
					// ネットワークの有無
					var network = check_network();
					// 保存している商品情報がない
					if (paramsText == null || paramsText == '') {
						// 通信がない
						if (network == 'none') {
							// 商品情報なし + 通信なし
							var message = 'しばらく待って再度QRコードを撮影してください';
							var button = 'OK';
							var title = '通信環境がよくないため商品情報が取得できませんでした。';
							navigator.notification.alert(message, barcodeCallBack(), title, button);
							// 通信あり
						} else {
							// 商品情報なし + 通信あり
							readOrdering();
						}
						// 商品情報あり
					} else {
						if (network == 'none') {
							// 商品情報あり + 通信なし
							var params = JSON.parse(paramsText);
							setData(params);
						} else {
							// 商品情報あり + 通信あり
							readOrdering();
						}
					}

					// 設定ファイルの読み込み
					function readOrdering() {
						getFile('ordering', getonOrderingOK, getonOrderingNG);
						// 読み込み：失敗
						function getonOrderingNG() {
							hrefStorageAll('index.html', storage);
							// window.location.href = "index.html";
						}

						// 読み込み：成功
						function getonOrderingOK(json) {
							// barcodeの読み取り結果
							var barParamsTxt = getLocalStorage('barcodeParams');
							console.log('readOrdering:success' + barParamsTxt);
							var hash = JSON.parse(barParamsTxt);
							console.log('readOrdering:json' + json);
							console.log('readOrdering:hash' + hash);

							// 顧客情報がある場合の処理
							if (json && json.customer_id) {
								var url = json.http + 'json/get_addressee.php';
								hash['customer_id'] = json.customer_id;
								hash['customer_key'] = json.customer_key;
								hash['customer_mail_1'] = json.customer_mail_1;
								hash['app_ver'] = json.app_ver;
								hash['app_code'] = json.app_code;
								hash['url'] = json.url;
								hash['http'] = json.http;
								hash['https'] = json.https;

								// 注文情報にアプリ情報 + 利用者情報 + URL情報を一旦保存 1
								setLocalStorage(storage, 'order_params', JSON.stringify(hash));
								// お届け先の初期化
								setLocalStorage(storage, 'address_name', '');

								// お届け先の問い合わせ
								$.ajax({
									type : "POST",
									url : url,
									data : hash,
									success : function(data) {
										if (data.address_id) {
											// お届け先セット
											setLocalStorage(storage, 'address_name', String(data.address_name));
											console.log('address_name: ' + data.address_name);
										}
										// 商品情報を取得
										sendData(hash);
									},
									error : function() {
										console.log('showItem:通信エラー');
										networkERR(settingCallBack, '通信エラー');
									}
								});
							}
						}

					}

					// 商品情報を取得 -----------------------------------------------------------------------
					function sendData(hash) {
						console.log('sendData:get: ' + JSON.stringify(hash));
						var url = hash.http + 'json/send_item_info.php';
						$.ajax({
							type : "POST",
							url : url,
							data : hash,
							success : function(data) {
								// 商品詳細 130207 空白もチェックする
								if (data != {} && data != null && data != '') {
									// 商品情報をセット
									setData(data);
								} else {
									var title = '再度QRコードを撮影してください';
									var message = '商品情報を取得できませんでした';
									var button = 'OK';
									navigator.notification.alert(message, barcodeCallBack(), title, button);
								}
							},
							error : function() {
								var title = 'しばらく待って再度QRコードを撮影してください';
								var message = '通信環境がよくないため商品情報が取得できませんでした。';
								var button = 'OK';
								navigator.notification.alert(message, barcodeCallBack(), title, button);
							}
						});
						function barcodeCallBack() {
							// window.location.href = 'barcode.html';
							// エラーの場合、barcode画面からのバックボタンのリンクをsetting.htmlに変更
							setLocalStorage(storage, 'before', 'setting.html');
							hrefStorageAll('setting.html', storage);
						}

					}

					// 商品情報をセット
					function setData(params) {

						// 購入商品表示フラグで戻るボタンを表示・非表示
						var show_order_flg = getLocalStorage('show_order_flg');
						console.log('barcode:showItem:show_order_flg: ' + show_order_flg);

						// 戻るボタン非表示
						var before = getLocalStorage('before');
						console.log('barcode:showItem:before: ' + before);
						if (show_order_flg == 'false' && before == 'show_order.html') {
							$("#backb").css("display", "none");
							setLocalStorage(storage, 'show_item_flg', "true");
						// 戻るボタン表示
						} else if (show_order_flg == 'true' && before == 'show_order.html') {
							$("#backb").attr("href", "show_order.html");
							$("#backb").css("display", "block");
							setLocalStorage(storage, 'show_order_flg', "true");
						}

						// 商品表示 true
						setLocalStorage(storage, 'show_item_flg', 'true');
						setLocalStorage(storage, 'before', 'barcode.html');

						console.log('setData:params: ' + JSON.stringify(params));
						// サーバからの商品情報の保持
						setLocalStorage(storage, 'show_item_params', JSON.stringify(params));
						// 注文一時情報にitemVersion,sampleVersionを追加 2
						var order_params = JSON.parse(getLocalStorage('order_params'));
						order_params['item_version'] = params.item_version;
						order_params['sample_id'] = params.sample_id;
						setLocalStorage(storage, 'order_params', JSON.stringify(order_params));

						// コンテンツの表示
						$("#loading").css("display", "none");
						$("#content").css("display", "block");

						// リストビューで表示
						$('.item_summary').listview();

						// タイトル表示
						$("#pageTitle").text('商品情報');

						// お届け先
						var addressee = getLocalStorage('address_name');
						console.log('お届け先: ' + addressee);
						if (addressee != null && addressee != '' && params.adr_flg == 1) {
							$("#addressee").css("display", "block");
							$("#recipient_subject").text(getLocalStorage('address_name'));
						}

						// 商品名
						$("#item_name").text(params['item_name']);

						// 商品画像
						$("#item_image1").attr("src", params['item_image']);

						// 商品価格
						item_price = '無料';
						if (parseInt(params['item_price']) > 0) {
							var item_price = currency(String(params['item_price'])) + '円';
						}
						$("#item_price").text(item_price);

						// 商品情報更新
						if (params['item_update_flg'] == 'enable' && parseInt(params['item_create_time']) != parseInt(params['item_update_time'])) {
							var data_change = '<div class="data_change"><div class="tl">' + getDate(params['item_update_time']) + ' 商品情報が変更されました</div></div>';
							document.getElementById("data_change").innerHTML = data_change;
						}

						// １個の送料 item_pay_sts
						setLocalStorage(storage, 'order_carriage', 0);
						if (params.ship_flg == 1) {
							var shippingCost = '<a href="#page_shopShipping" deta-transition="slide" data-ajax="false" class="shippingCost_link" onclick="javascript:getShipping();">';
							shippingCost += '<dl class="shippingCost"><dt>送料</dt><dd id="order_carriage"><span id="carriage">';
							// 送料有料のフラグ:carriage
							setLocalStorage(storage, 'shippingCost', 'carriage');
							if (parseInt(params['order_carriage']) > 0) {
								// 送料が有料の場合
								shippingCost += currency(params['order_carriage']) + '円</span></dd></dl>';
								// 送料の保存
								setLocalStorage(storage, 'order_carriage', params['order_carriage']);
							} else {
								// 送料０円の場合
								// 利用者情報の有無を判定
								if (addressee != null && addressee != '' && params.adr_flg == 1) {
									// 利用者情報がある:enable
									setLocalStorage(storage, 'shippingCost', 'enable');
									shippingCost += '<em style="font-size:15px;">送料無料</em></span></dd></dl>';
								} else {
									// 利用者情報がない:disable
									setLocalStorage(storage, 'shippingCost', 'disable');
									shippingCost += '<em style="font-size:15px;">送料を確認</em></span></dd></dl>';
								}
							}
							shippingCost += '<span class="ui-icon ui-icon-arrow-r ui-icon-shadow"></span></a>';
							// 送料無料金額 130206 </font>削除
							if (parseInt(params['non_carriage_price']) > 0) {
								var non_carriage_price = '<p style="font-size:11px;">' + currency(String(params['non_carriage_price'])) + '<span>円以上は送料無料</span></p>';
								shippingCost += non_carriage_price;
							}
							document.getElementById("shippingCost").innerHTML = shippingCost;
						}

						// 在庫状況
						item_stock_sts = '';
						if (params['item_is_activate_flg'] == 'disable' || params['item_is_ready_flg'] == 'disable') {
							item_stock_sts = '<p class="ico ico_backOrder">販売準備中</p>';
							$('#item_buy_3').css('display', 'none');
							$('#notSalesMsg').css('display', 'block');
							$('.buyView').css('display', 'none');

						} else if (params.item_stock_sts == 'backstock') {
							item_stock_sts = '<p class="ico ico_backOrder">入荷待ち</p>';
							$('#item_buy_3').css('display', 'none');
							$('#notSalesMsg').css('display', 'block');
							$('.buyView').css('display', 'none');

						} else if (params.item_stock_sts == 'discontinued') {
							item_stock_sts = '<p class="ico ico_discontinued">販売期間終了</p>';
							$('#item_buy_3').css('display', 'none');
							$('#notSalesMsg').css('display', 'block');
							$('.buyView').css('display', 'none');

						} else if (params.item_stock_sts == 'nostock' || parseInt(params.item_stock_sts) < 1 || parseInt(params.item_stock_sts) < parseInt(params.item_min_sales)) {
							item_stock_sts = '<p class="ico ico_backOrder">在庫切れ</p>';
							$('#item_buy_3').css('display', 'none');
							$('#notSalesMsg').css('display', 'block');
							$('.buyView').css('display', 'none');

						} else if (params.item_is_stop_flg == 'disable') {
							item_stock_sts = '<p class="ico ico_discontinued">販売中止</p>';
							$('#item_buy_3').css('display', 'none');
							$('#notSalesMsg').css('display', 'block');
							$('.buyView').css('display', 'none');

						} else if (parseInt(params.item_stock_sts) < 3 && parseInt(params.item_stock_sts) > 0) {
							item_stock_sts = '<p class="ico ico_onlyRemaining">残りわずか</p>';
						}
						// 販売ステータスがある
						if (item_stock_sts != '') {
							document.getElementById("item_stock_sts").innerHTML = item_stock_sts;
						}

						/* //////////////////////////////////////////////////
							支払いステータスの説明
								pat_card:カード払い
								pay_cod: 代金引換
								ordeercommission:代引手数料
								non_ordercommission:代引き手数料無料になる金額
						*/ //////////////////////////////////////////////////
						var item_pay_sts = '';
						if (params.pay_card == 1) {
							// カード払い
							item_pay_sts = '<p class="ico ico_onlyRemaining">カード払い</p>';
							
						} else if (params.pay_cod == 1) {
							// 代引き
							item_pay_sts = '<p class="ico ico_onlyRemaining">代金引換</p>';
							if (params.ordercommission && parseInt(params.ordercommission) > 0) {
								// 代引き手数料:表示する
								var pay_codCost = ' <span>手数料：' + currency(params.ordercommission) + '円</span>';
								// 代引き手数料無料 130206 </font>削除
								if (parseInt(params['non_ordercommission']) > 0) {
									non_ordercommission = '<p style="font-size:11px;">' + currency(String(params['non_ordercommission'])) + '<span>円以上は手数料無料</span></p>';
								}
								$("#pay_cod_cost").html(pay_codCost);
								$("#non_ordercommission").html(non_ordercommission);
							} else {
								// 代引き手数料:表示しない
								params.ordercommission = 0;
								params.non_ordercommission = 0;
							}
						}
						$("#item_pay_sts").html(item_pay_sts);
						
						// 合計金額
						var isShippingCost = getLocalStorage('shippingCost');
						if (isShippingCost != 'disable') {
							$("#total_price_text").text("ご購入合計金額：");
						} else {
							$("#total_price_text").text("ご購入合計金額（別途送料）：");
						}
						// 販売フラグを判定
						if (params.is_sales_flg == 'enable') {
							// 販売 OK
							var total_price = currency(String(parseInt(params.item_price) + parseInt(params.order_carriage) + parseInt(params.ordercommission))) + '円(税込)';
							$("#total").text(total_price);
						} else {
							// 販売 NG
							$('#total_price').css('display', 'none');
						}

						// 数量
						if (params.is_sales_flg == 'enable') {
							// 販売できる場合
							var amount = '';
							var min = parseInt(params.item_min_sales);
							var max = 1;
							if (parseInt(params.item_stock_sts) > parseInt(params.item_max_sales)) {
								max = parseInt(params.item_max_sales);
							} else {
								max = parseInt(params.item_stock_sts);
							}
							for (var i = min; i <= max; i++) {
								var goodsTotal = (parseInt(params.item_price) * i);

								// 送料の計算 130206 INS Start
								var orderCarriage = 0;
								if( parseInt(params.non_carriage_price) > 0 && goodsTotal >= parseInt(params.non_carriage_price) ){
									orderCarriage = 0;
								}else if( goodsTotal <= parseInt(params.non_order_carriage1)){
									orderCarriage = parseInt(params.order_carriage1);
								}else if( goodsTotal <= parseInt(params.non_order_carriage2)){
									orderCarriage = parseInt(params.order_carriage2);
								}else if( goodsTotal <= parseInt(params.non_order_carriage3)){
									orderCarriage = parseInt(params.order_carriage3);
								}else if( goodsTotal <= parseInt(params.non_order_carriage4)){
									orderCarriage = parseInt(params.order_carriage4);
								}else if( goodsTotal <= parseInt(params.non_order_carriage5)){
									orderCarriage = parseInt(params.order_carriage5);
								}else{
									orderCarriage = parseInt(params.order_carriage);
								}
							// 送料の計算 130206 INS END

							// 合計金額をrelに、送料をrel2持たせる 130206 EDIT
								amount += '<option value="' + String(i) + '" rel="' + goodsTotal + '" rel2="' + orderCarriage + '">' + String(i) + '</option>';
							}

							$('#order_amount').html(amount).selectmenu('refresh', true);
							// 数量フラグ 非表示:0
/*  DEL 130207 変更
							if (params.amo_flg == 0) {
								// 数量 非表示
								$("#item_quantity").css('display', 'none');
							}
*/
//  INS 130207 Start
							if (params.amo_flg == 0) {
								// 数量 非表示
									var item_quantity = "<div class='inner'><div date-role='fieldcontain'><p>　　　</p></div></div><hidden name='order_amount' value=1 />";
									$("#item_quantity").html(item_quantity);
							}
//  INS 130207 End

						} else {
							// 販売できない場合
							// 数量・購入ボタンの列を非表示
							$('#item_quantity_buy').css('display', 'none');
							// ページ下部の購入ボタンを非表示
							$('#item_buy_3').css('display', 'none');
						}

						// 商品説明
						var shop_contact = '<div class="txt" style="font-weight:bold;">' + params.item_name + '</div><div class="txt">';
						shop_contact = shop_contact + params.item_short_desc + '</div>';
						document.getElementById("shop_contact").innerHTML = shop_contact;

						// 販売社名
						document.getElementById("company_name").innerText = String(params['company_name']);
						$("#company_phone_go").attr("href", "tel:" + params['company_phone']);

						// ボタン表示
						if (params.btn_flg == 0) {
							$('#item_quantity_buy2').css("display", "none");
							$('#item_buy_3').css("display", "none");
						} else if (params.btn_flg == 1) {
							$('#btn_flg').html("購入する");
							$('#btn_flg2').html("購入する");
						} else if (params.btn_flg == 2) {
// 130207 ボタン名を取得するよう修正
//							$('#btn_flg').html("申し込む");
//							$('#btn_flg2').html("申し込む");String
							$('#btn_flg').html(String(params.btn_name));
							$('#btn_flg2').html(String(params.btn_name));

						}

						// 削除ボタン表示
						$("#deleteParams").css("display", "block");

						// お問い合わせフォーム用のデータセット
						var contactParams = {
							qr_id : params.qr_id,
							item_version : params.item_version,
							customer_id : params.customer_id
						}
						setLocalStorage(storage, "contactParams", JSON.stringify(contactParams));
						$("#contact").attr("href", 'contact.html');

						// 数量変更で保存した値をセット item_pay_sts
						var initBackAmount = getLocalStorage('initBackAmount');
						// 適用するか判定
						if (initBackAmount != 'true') {
							// 数量変更で保存した値を取得
							getFile("backAmount", ChPriceOK, ChPriceNG);
							// 取得成功
							function ChPriceOK(hash) {
								hash = JSON.parse(hash);
								// 合計金額タイトル
								var totalTitle = String(hash.totalTitle);
								// 表示合計金額
								var total = currency(String(hash.total)) + '円(税込)';
								// 購入数量
								var amount = String(hash.selectedValue);
								// 送料 html
								var carriage = hash.carriage;
								// 手数料 html
								var commission = hash.commission;
								
								// 合計金額タイトルの表示
								$("#total_price_text").text(totalTitle);
								// 送料表示
								$('#order_carriage').html(htmlCarriage);
								// 代引き手数料表示
								$("#pay_cod_cost").html(htmlCommission);
								// 合計金額表示
								$("#total").text(currency(String(total)) + '円(税込)');
								
								// 購入数量表示
								$('#order_amount').val(amount).selectmenu('refresh', true);
								
								// 送料有料の場合
								//$('#total').text(currency(String($('#order_amount option:selected').attr('rel'))));
							}

							function ChPriceNG() {
								console.log('backAmount: NG');
							}

						}
					}

					// 計測
					var showTime = parseInt(new Date().getTime()) - parseInt(getLocalStorage('time'));
					console.log('QRコード読み取りから商品表示までの時間: ' + showTime);

				}// showItem

			}// onDeviceReady

			// 数量の変更に連動して合計金額と送料表示を変更する
			function changePrice() {
				var paramsText = getLocalStorage('show_item_params');
				var params = JSON.parse(paramsText);
				// 計算用の合計金額
				var goodsTotal = parseInt($('#order_amount option:selected').attr('rel'));

				// 計算用の送料 INS 130206
				var orderCarriage = parseInt($('#order_amount option:selected').attr('rel2'));

				// 購入数量
				var amount = parseInt($('#order_amount option:selected').val());
				//　計算用:商品のみ合計金額、代引き手数料、送料
				var commission = parseInt(params.ordercommission);
// 130206 DEL
//				var carriage = parseInt(getLocalStorage('order_carriage'));
// 130206 INS
					var carriage = orderCarriage;

				// 合計金額の表示タイトル
				var totalTitle = 'ご購入合計金額：';
				// 初期化
				var total = 0;
				var htmlCarriage   = '';
				var htmlCommission = '';
				
				// 送料表示の判定
				var shippingCost = getLocalStorage('shippingCost');
// 130206 INS aタグ追加
				htmlCarriage = '<a href="#page_shopShipping" deta-transition="slide" data-ajax="false" class="shippingCost_link" onclick="javascript:getShipping();">';
				htmlCarriage += '<dl class="shippingCost"><dt>送料</dt><dd id="order_carriage">';
				if (shippingCost != 'disable') {
					// お届け先がある・送料表示をする
					// 送料無料の反映
/* 130206 DEL
					if (params.non_carriage_price == 0 || goodsTotal >= parseInt(params.non_carriage_price)) {
						htmlCarriage = '<span id="carriage"><em style="font-size:15px;">送料無料</em></span>';
						carriage = 0;
					} else {
						htmlCarriage = '<span id="carriage">' + currency(String(params.order_carriage)) + '円</span>';
					}
*/
// 130206 INS Start
					if ( orderCarriage == 0 ) {
						htmlCarriage += '<span id="carriage"><em style="font-size:15px;">送料無料</em></span>';
						carriage = 0;
					} else {
						htmlCarriage += '<span id="carriage">' + currency(String(orderCarriage)) + '円</span>';
					}
//  130206 INS End
				} else {
					// お届け先がない場合（送料確認）
					var addressee = getLocalStorage('address_name');
					if((addressee == null || addressee == '') && params.adr_flg == 1){
						// 130206 INS 送料確認 → 送料を確認
						htmlCarriage += '<span id="carriage"><em style="font-size:15px;">送料を確認</em></span>';
						totalTitle = 'ご購入合計金額（別途送料）：';
						carriage = 0;
					}
// 130206 DEL htmlCarriage += '</dd></dl></a>';
				}
				htmlCarriage += '</dd></dl></a>';

				//代引き手数料の判定 item_pay_sts
				if(params.non_ordercommission > 0){
					if (goodsTotal >= parseInt(params.non_ordercommission)) {
						htmlCommission = '<span id="commission">手数料無料</span>';
						commission = 0;
					} else {
						htmlCommission = '<span id="commission">手数料：' + currency(String(params.ordercommission)) + '円</span>';
					}
				}
				// 合計金額の生成
				total = goodsTotal + carriage + commission;
				// 合計金額タイトルの表示
				$("#total_price_text").text(totalTitle);

				// 送料表示するの場合のみ INS 130207
				if (params.ship_flg == 1) {
					// 送料表示
					$('#shippingCost').html(htmlCarriage);
				}

				// 代引き手数料表示
				$("#pay_cod_cost").html(htmlCommission);
				// 合計金額表示
				$("#total").text(currency(String(total)) + '円(税込)');

				// 変化した値（合計金額タイトル・表示合計金額・送料・手数料・購入数量）
				var chPrice = {
					totalTitle: totalTitle,
					total: total,
					carriage: htmlCarriage,
					commission: htmlCommission,
					selectedValue: $('#order_amount').val()
				};
				// 変化した値の保存
				setLocalStorage(storage, 'initBackAmount', 'false');
				setFile("backAmount", JSON.stringify(chPrice), chPriceOK, chPriceNG);
				function chPriceOK(hash) {
					console.log('set:backAmount:OK: ' + hash);
					// ページ位置を戻す
					errorFocus($('#content'));
				}

				function chPriceNG() {
					// ページ位置を戻す
					errorFocus($('#content'));
				}

			}// changePrice

			// 注文前判定
			function order() {

				// 設定情報の読み込み
				getFile('ordering', getonOrderingOK, getonOrderingNG);
				// 読み込み：失敗
				function getonOrderingNG() {
					var button = 'OK';
					var title = '注文処理を完了できませんでした';
					var message = 'ご注文に必要なご利用者情報を取得できませんでした。';
					navigator.notification.alert(data, function() {
					}, title, button);
				}

				// 読み込み：成功
				function getonOrderingOK(json) {

					// 購入時の暗証番号入力フラグ判定
					var inputPasscode = getLocalStorage('inputPasscode');

					if (inputPasscode == 'true') {
						// 暗証番号入力する
						var passTime = parseInt(getLocalStorage('passTime'));
						var nowTime = parseInt(new Date() / 1000);
						var overTime = 60 * 60;
						if (nowTime - passTime > overTime && json.customer_id != 0) {
							// 前回操作から時間が経過 + 暗証番号入力していない
							// 暗証番号入力する
							$("#popupForm").trigger('click');
						} else {
							// 前回操作から時間が経過していない || 前回操作から時間が経過 + 暗証番号入力済み
							getonOrderingOK2(json);
						}
					} else {
						// 暗証番号入力しない
							getonOrderingOK2(json);
					}
				}
			}// order

			function getonOrderingOK2(json){
				// 注文一時情報にorder_time,order_amountを追加 3
				var order_params = JSON.parse(getLocalStorage('order_params'));
				// 注文数量の取得
				order_params['order_amount'] = document.getElementById('order_amount').value;
				// 注文情報の一時保存
				setLocalStorage(storage, 'order_params', JSON.stringify(order_params));

				// 購入ボタンをクリックフラッグ２つ　130206 INS
				setLocalStorage(storage, 'purchased_item_flg', 'ordered');

				// 設定済み判定
				var url = json.http + 'json/send_setup.php';
				$.ajax({
					type : "POST",
					url : url,
					data : json,
					success : function(data) {
						var title = '初期設定';
						var message = '';
						var button = 'OK';
						// 設定済み
						if (data.setup_ok == 1) {
							// 暗証番号入力済みか判定へ
							order2(json);
						} else if (data.password_ck == 0) {
							console.log("-- 暗証番号--");
							message = '１．暗証番号を設定してください。';
							navigator.notification.alert(message, passcodeAlert, title, button);
							function passcodeAlert() {
								hrefStorageAll('passcode_new.html', storage);
								// window.location.href = "passcode_new.html";
							}

						} else if (data.customer_ck == 0) {
							console.log("-- 利用者情報・お届け先 --");
							message = '２．あなた様のお名前やご住所を設定してください。';
							navigator.notification.alert(message, orderingAlert, title, button);
							function orderingAlert() {
								hrefStorageAll('ordering_new.html', storage);
								// window.location.href = "ordering_new.html";
							}

						} else if (data.address_ck == 0) {
							console.log("-- お届け先 --");
							message = '３．お届け先のお名前やご住所を設定してください。';
							navigator.notification.alert(message, addresseeAlert, title, button);
							function addresseeAlert() {
								hrefStorageAll('addressee_new.html', storage);
								// window.location.href = "addressee_new.html";
							}

						} else if (data.card_ck == 0) {
							// カード払い
							var paramsText = getLocalStorage('show_item_params');
							var show_item_params = JSON.parse(paramsText);
							if ( show_item_params.pay_card && show_item_params.pay_card == 1 ) {
								console.log("-- カード--");
								message = '４．お支払いに使うクレジットカード情報を設定してください。クレジットカードはご本人様（個人設定にて設定したお名前・ご住所）のカード以外はご利用いただけません。';
								navigator.notification.alert(message, cardAlert, title, button);
								function cardAlert() {
									hrefStorageAll('card_new.html', storage);
								}
							} else {
								// 代引き
								order2(json);
							}
						} else {
							console.log("-- エラー１: 設定がない--");
							message = '１．暗証番号を設定してください。';
							navigator.notification.alert(message, etcAlert, title, button);
							function etcAlert() {
								hrefStorageAll('passcode_new.html', storage);
								// window.location.href = "passcode_new.html";
							}

						}
					},
					error : function(data) {
						console.log("-- エラー２: 設定がない--");
						title = "初期設定";
						var message = '１．暗証番号を設定してください。';
						navigator.notification.alert(message, etcAlert, title, 'OK');
						function etcAlert() {
							hrefStorageAll('passcode_new.html', storage);
							// window.location.href = "passcode_new.html";
						}

					}
				});
			}


			// 暗証番号のチェック
			function eqPass() {
				// 設定の読み込み
				getFile('ordering', eqPassOK, eqPassNG);
				// 読み込み:失敗
				function eqPassNG() {
					hrefStorageAll('index.html', storage);
					// window.location.href = "index.html";
				}

				// 読み込み:成功
				function eqPassOK(json) {
					// 入力値
					var ckPass1 = String($("#customer_pass").val());
					var ckPass2 = String(json.customer_pass);
					// 入力値のチェック
					if (ckPass1 != ckPass2) {
						var message = '暗証番号が違います';
						var title = 'エラー';
						var button = 'OK';
						navigator.notification.alert(message, function() {
							$("#customer_pass").val('');
						}, title, button);
						return false;

						// 入力値が合っている
					} else {
						$('.ui-dialog').dialog('close');  // ダイアログを閉じる
						// passTime更新
						setLocalStorage(storage, 'passTime', parseInt(new Date() / 1000));
						// 注文処理へ
						getonOrderingOK2(json);
					}
				}

			}//eqPass

			// 注文処理
			function order2() {
				//loading呼び出し
				$('#content').css('display', 'none');
				$('#loading').css('display', 'block');
				// 注文一時情報にorder_time,order_amountを追加 3
				var order_params = JSON.parse(getLocalStorage('order_params'));
				// 注文時間の生成
				order_params['order_time'] = parseInt(new Date() / 1000);
				// 注文情報の一時保存
				setLocalStorage(storage, 'order_params', JSON.stringify(order_params));
				// passTime更新
				setLocalStorage(storage, 'passTime', parseInt(new Date() / 1000));
				// 購入ボタンをクリックフラッグ２つ
				setLocalStorage(storage, 'purchased_item_flg', 'ordered');
				setLocalStorage(storage, 'kbn', 'buy');
				// 暗証番号の入力フラグ
				setLocalStorage(storage, 'inputedPass', 'false');
				// 変更した入力値をクリア
				delFile("backAmount");
				// 注文情報の保存
				setFile('order', order_params, goOrder, goOrder);
				// 注文処理へ
				function goOrder() {
					// order情報の取得
					var order_params = JSON.parse(getLocalStorage('order_params'));
					// 注文情報をサーバに送信
					setOrder(order_params);
				}

			}// order2

			// サーバー通信を行い値を設定を行なう
			function setOrder(order) {
				// order:注文情報
				console.log("Start post:" + JSON.stringify(order));
				var url = order.https + 'json/receive_order.php';
				$.ajax({
					type : "POST",
					url : url,
					data : order,
					success : function(data) {
						// 注文処理結果の判定
						if (data.errmsg) {
							// サーバからエラーメッセージがある
							// カードエラー
							console.log("-- サーバからエラーメッセージ --");
							var msg = {};
							msg['title'] = data.errtitle;
							msg['msg'] = data.errmsg;
							// 暗証番号ポップアップを閉じる
							$("#popupClose").trigger('click');
							cardErrMsg(msg);
						} else {
							// 注文完了
							if (data.order_id > 0 && data.order_id < 99999999999) {
								console.log("-- 注文完了--");
								// 暗証番号ポップアップを閉じる
								$("#popupClose").trigger('click');
								// サーバへ注文処理を行う
								okOrder();
								//注文失敗
							} else {
								console.log("-- 注文失敗--");
								// 暗証番号ポップアップを閉じる
								$("#popupClose").trigger('click');
								navigator.notification.alert('注文処理を完了できませんでした。あらためてご注文ください。', function() {
									// 商品情報表示フラグ:ture
									setLocalStorage(storage, 'show_item_flg', 'true');
									hrefStorageAll('barcode.html', storage);
									// window.location.href = 'barcode.html';
								}, "注文できませんでした", "OK");
							}
						}
						// 注文情報の消去
//						delFile('order_params'); // DEL 130207
					},
					error : function(data) {
						console.log('setOrder:通信エラー');
						// 商品情報表示フラグ:true
						setLocalStorage(storage, 'show_item_flg', 'true');
						networkERR(settingCallBack, '通信エラー');
					}
				});
			}

			// 注文完了メッセージ
			function okOrder() {
				var cancelAttention = getLocalStorage('cancelAttention');
				if (cancelAttention == '') {
					setLocalStorage(storage, 'cancelAttention', 'enable');
				}
					// 購入ボタンのクリックフラグをリセット
					setLocalStorage(storage, 'purchased_item_flg', '');
					setLocalStorage(storage, 'kbn', '');
					// 購入履歴表示
					setLocalStorage(storage, 'show_order_flg', 'false');
					delFile('barcodeParams');
					setLocalStorage(storage, 'show_item_flg', 'false');

					// 注文情報の初期化
					initOrderInfo();
					
					hrefStorageAll('show_order.html', storage);
			}

			// カード情報エラー
			function cardErrMsg(msg) {
				var button = 'OK';
				console.log('cardErrMsg:通信エラー');
				navigator.notification.alert(msg.msg, settingCallBack(), msg.title, button);
			}

			// 注文情報の初期化
			function initOrderInfo() {
				// 注文情報初期化
				var order = {};
				order['qr_id'] = "";
				setFile('order', JSON.stringify(order), initOrder, initOrder);
				function initOrder() {
					// 入力保存初期化
					var backAmount = {};
					setFile('backAmount', JSON.stringify(backAmount), initBackAmount, initBackAmount);
					function initBackAmount() {
						var barcodeParams = {};
						setLocalStorage(storage, 'barcodeParams', barcodeParams);
						console.log('finish initOrderInfo');
					}

				}

			}
			
			// setting.htmlへ
			function settingCallBack() {
				hrefStorageAll('setting.html', storage);
				// window.location.href = 'setting.html';
			}

			// 特商ページ 130201 INS
			function getProfile() {
				var chNetwork = check_network();
				if (chNetwork != "none") {
					// 特商情報取得
					var get = JSON.parse(getLocalStorage('barcodeParams'));
					var filename = "http://exorder.jp/products/?page=profile&qr_id=" + String(get.qr_id);
					// html取得
					getIndex(filename);
					function getIndex(filename) {
						xmlhttp = new XMLHttpRequest();
						if (xmlhttp) {
							xmlhttp.onreadystatechange = check;
							xmlhttp.open("GET", filename);
							xmlhttp.send(null);
						}
					}

					function check() {
						if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
							document.getElementById("htmlProfile").innerHTML = xmlhttp.responseText;
						}
					}

				} else {
					var title = '現在表示できません'
					var message = '通信環境が良くないため販売店情報を表示できませんでした';
					navigator.notification.alert(message, errorAlert(), title, 'OK');
					function errorAlert() {
						console.log('chNetwork: ' + chNetwork);
					}

				}
			}

			// 送料ページ 130201 INS
			function getShipping() {
				var chNetwork = check_network();
				if (chNetwork != "none") {
					var get = JSON.parse(getLocalStorage('barcodeParams'));
					var filename = "http://exorder.jp/products/?page=shipping&qr_id=" + String(get.qr_id);
					// html取得
					getIndex(filename);
					function getIndex(filename) {
						xmlhttp = new XMLHttpRequest();
						if (xmlhttp) {
							xmlhttp.onreadystatechange = check;
							xmlhttp.open("GET", filename);
							xmlhttp.send(null);
						}
					}

					function check() {
						if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
							console.log('送料：xmlhttp.responseText: ' + xmlhttp.responseText);
							$("#htmlShipping").html(xmlhttp.responseText);
						}
					}

				} else {
					var title = '現在表示できません'
					var message = '通信環境が良くないため販売店情報を表示できませんでした';
					navigator.notification.alert(message, errorAlert(), title, 'OK');
					function errorAlert() {
						console.log('chNetwork: ' + chNetwork);
					}

				}
			}

			// 戻る設定
			function backb2() {
				setLocalStorage(storage, 'show_item_flg', 'true');
				hrefStorageAll('barcode.html', storage);
				// window.location.href = 'barcode.html';
			}

			// お届け先一覧
			function addressee_index() {
				setLocalStorage(storage, 'show_item_flg', 'true');
				setLocalStorage(storage, 'before', 'barcode.html');
				hrefStorageAll('addressee_index.html', storage);
				// window.location.href = 'addressee_index.html';
			}

			// 商品データ削除
			function deleteParams() {
				delFile('barcodeParams');
				// 130208 INS
				setLocalStorage(storage, 'purchased_item_flg', '');
				setLocalStorage(storage, 'kbn', '');
				setLocalStorage(storage, 'show_item_flg', 'false');
				setLocalStorage(storage, 'before', 'setting.html');
				hrefStorageAll('setting.html', storage);
				// window.location.href = 'setting.html';
			}

			// navバーのbarcode選択でbarcode画面表示にフラグを切り替え
			function chShowItemFlg() {
				setLocalStorage(storage, 'show_item_flg', 'false');
				hrefStorageAll('barcode.html', storage);
				// window.location.href = 'barcode.html';
			}

			// navバーの購入履歴選択で画面表示フラグを切り替え
			function chShowOrderFlg() {
				setLocalStorage(storage, 'show_order_flg', 'false');
				hrefStorageAll('show_order.html', storage);
				// window.location.href = 'show_order.html';
			}

		</script>

	</head>

	<body>
		<div id="page_itemDetail" data-role="page" data-add-back-btn="false" data-theme="z">
			<div data-role="header" id="header" data-position="fixed">
				<h1 id="pageTitle"></h1>
				<a id="backb" href="barcode.html" class="ui-btn-left" data-icon="arrow-l" data-direction="reverse" data-ajax="false" style="display: none;">戻る</a>
				<a id="deleteParams" href="" class="ui-btn-right" data-icon="delete" data-ajax="false" onClick="deleteParams();" style="display:none;"> 削除 </a>
			</div>
			<!-- loading -->
			<div class="loading" data-role="content" id="loading" style="display:none;">
				<div class="loading_box">
					<p>
						しばらくおまちください
					</p>
					<div id="loadingImg" class="square"></div>
					<script>
						// spin setting
						var opts = {
							ines : 11, // The number of lines to draw
							length : 6, // The length of each line
							width : 3, // The line thickness
							radius : 8, // The radius of the inner circle
							corners : 0.9, // Corner roundness (0..1)
							rotate : 0, // The rotation offset
							color : '#666', // #rgb or #rrggbb
							speed : 0.7, // Rounds per second
							trail : 33, // Afterglow percentage
							shadow : false, // Whether to render a shadow
							hwaccel : true, // Whether to use hardware acceleration
							className : 'spinner', // The CSS class to assign to the spinner
							zIndex : 2e9, // The z-index (defaults to 2000000000)
							top : 'auto', // Top position relative to parent in px
							left : 'auto' // Left position relative to parent in px
						};
						var target = document.getElementById('loadingImg');
						var spinner = new Spinner(opts).spin(target);
					</script>
				</div>
			</div>

			<!-- content -->
			<div class="cont_itemDetail" data-role="content" id="content" style="display:none;">
				<div id="item_version_tete" ></div>
				<!-- 商品情報変更 -->
				<div id="data_change"></div>
				<ul class="item_summary" data-role="listview">
					<!-- 商品名 -->
					<li class="item_name">
						<h1 class="name" id="item_name">商品名</h1>
					</li>
					<li class="item_img_price">
						<div class="box2">
							<!-- 商品画像 -->
							<div class="box2_01 item_img">
								<div class="inner" id="item_image">
									<img src="#" width="150" height="150" alt="商品画像" id="item_image1"/>
								</div>
							</div>
							<div class="box2_02 item_price">
								<!-- 価格 -->
								<dl class="price">
									<dt>
										価格
									</dt>
									<dd id="item_price"></dd>
								</dl>
								<!-- 送料 -->
								<div id="shippingCost"></div>
								<!-- 送料無料 -->
								<div id="non_carriage_price" class="shippingCost"></div>
								<!-- 支払い方法 -->
								<div id="item_pay_sts"></div>
								<!-- 代引き手数料 -->
								<div id="pay_cod_cost"></div>
								<!-- 代引き手数料無料 -->
								<div id="non_ordercommission" class="shippingCost"></div>
								<!-- 在庫状況 -->
								<div id="item_stock_sts"></div>
							</div>
						</div>
					</li>
					<!-- 合計金額 -->
					<li id="total_price" class="total_price buyView">
						<div class="item_buy_price">
							<span id="total_price_text">ご購入合計金額：</span>
							<span id="total"></span>
						</div>
					</li>
					<!-- 数量-->
					<li class="item_quantity_buy buyView" id="item_quantity_buy">
						<div class="box2">
							<div id="item_quantity" class="box2_01 item_quantity">
								<div class="inner">
									<div date-role="fieldcontain">
										<p>
											数量：
											<select class="itemValue" id="order_amount" name="order_amount" onChange="changePrice();">
												<option value=1 id="item_quantity_sel">1</option>
											</select>
										</p>
									</div>
								</div>
							</div>
							<div class="box2_02 item_buy btn_txt_ow" id="item_quantity_buy2">
								<a id="btn_flg" class="btn_next" type="button" onClick="order(); return false" style="padding:10px;">購入する</a>
							</div>
						</div>
					</li>
				</ul>
				<!-- お届け先 -->
				<ul id="addressee" class="item_summary" data-role="listview" style="display:none;">
					<li id="item_shippingAddress" class="item_shippingAddress">
						<a href="#" data-ajax="false" onClick="addressee_index();"> 現在のお届け先：<span id="recipient_subject"></span>
						<p class="txt">
							お届け先の変更はこちら
						</p> </a>
					</li>
				</ul>
				<ul class="item_summary" data-role="listview">
					<!-- 商品説明 -->
					<li class="shop_contact" id="shop_contact" ></li>
					<!-- 販売者 -->
					<li class="shop_neme">
						<!--<a href="show_shop_info.html" deta-transition="slide" data-ajax="false" onclick="javascript:getProfile();"> 販売者：<span id="company_name"></span>-->
						<!-- EDIT 130207 -->
						<a href="#page_shopProfile"  deta-transition="slidefade" onclick="javascript:getProfile();"> 販売者：<span id="company_name"></span>
						<p class="txt">
							販売者・特定商取引の詳細はこちら
						</p> </a>
					</li>
					<li class="shop_contact">
						<div class="txt">
							販売者へのお問い合わせはこちらから
						</div>
						<div class="box2">
							<div class="box2_01 contact_link">
								<a class="btn_prev form_link" href="" data-role="button"  data-ajax="false" id="contact">フォームから</a>
							</div>
							<div class="box2_02 tel_link" id="company_phone" >
								<a class="btn_prev tel_link" href="#" data-role="button" id="company_phone_go">電話から</a>
							</div>
						</div>
					</li>
					<li class="item_buy_1btn" id="item_buy_3">
						<div class="item_buy btn_txt_ow">
							<a id="btn_flg2" class="btn_next" type="button" onClick="order(); return false" style="padding:10px;">購入する</a>
						</div>
					</li>

					<!-- 暗証番号入力 -->
					<li style="display: none;">
						<a id="popupForm" href="#popupLogin" data-rel="dialog" data-transition="pop">　</a>
<!-- DEL 130208
						<a id="popupForm" href="#popupLogin" data-rel="popup" data-position-to="window" data-role="button" data-inline="true" data-transition="pop">a</a>
						<div data-role="popup" data-overlay-theme="a" data-theme="a" id="popupLogin" class="ui-corner-all" style="max-width:480px;">

							<div class="page_description">
								<div class="txt">
									暗証番号を入力してください
								</div>
							</div>

							<div id="form_password">
								<input type="hidden" id="customer_passT" name="customer_passT" value=""/>

								<div data-role="fieldcontain" style="padding: 10px;">

									<label for="customer_pass" class="fieldLabel">暗証番号<span class="form_note">(数字4～16桁)</span></label>
									<input type="password" autocomplete="off" id="customer_pass" name="customer_pass" value="" maxlength=16 placeholder="数字4～16桁" />

									<div data-role="content" data-theme="a" class="ui-corner-bottom ui-content" style="margin-top: 10px;">
										<a href="#" data-role="button" data-inline="true" data-transition="flow" data-theme="b" id="btnOrder" class="btn_next" onclick="eqPass();">購入する</a>
										<a href="#" data-role="button" data-inline="true" data-rel="back" data-theme="c" id="popupClose" onclick="javascript:setLocalStorage(storage, 'purchased_item_flg', '');">閉じる</a>
									</div>

									<div class="txt" style="margin-top: 30px;">
										<a href="passcode_hint.html" data-ajax="false">暗証番号を忘れた方はコチラ</a>
									</div>
								</div>
							</div>
						</div>
-->

					</li>
				</ul>
			</div>

			<!-- nav -->
			<div id="nav" class="footer" data-role="footer" data-position="fixed" data-id="tabber" style="display:none;">
				<ul>
					<li class="tab01">
						<a href="#" data-ajax="false"  onclick="chShowOrderFlg();"> <span>購入履歴</span> </a>
					</li>
					<li class="tab02">
						<a href="#" data-ajax="false" onclick="chShowItemFlg();"> <span>読み取り</span> </a>
					</li>
					<li class="tab03">
						<a href="setting.html" data-ajax="false"> <span>設定</span> </a>
					</li>
				</ul>
			</div>
		</div>

		<!-- 販売者・特定商取引 130201 UPD -->
		<div id="page_shopProfile" data-role="page" data-add-back-btn="false" data-theme="z">
			<div data-role="header" id="header" data-position="fixed">
				<h1>特定商取引情報</h1>
				<a href="#page_itemDetail" class="ui-btn-left" data-icon="arrow-l" data-direction="reverse" data-rel="back"> 戻る </a>
			</div>
			<!-- コンテンツここから-->
			<div id="htmlProfile"></div>
		</div>

		<!-- 送料ページ追加 130201 INS -->
		<div id="page_shopShipping" data-role="page" data-add-back-btn="false" data-theme="z">
			<div data-role="header" id="header" data-position="fixed">
				<h1>送料</h1>
				<a href="#page_itemDetail" class="ui-btn-left" data-icon="arrow-l" data-direction="reverse" data-rel="back"> 戻る </a>
			</div>
			<!-- コンテンツここから-->
			<div id="htmlShipping"></div>
		</div>

		<!-- 暗証番号 130208 TEST -->
		<div id="popupLogin" data-role="page" data-theme="b">
			<!-- コンテンツここから-->
			<div data-role="content">
				<p>操作を続けるには、暗証番号を入力してください</p>
				<input type="password" autocomplete="off" id="customer_pass" name="customer_pass" value="" maxlength=16 placeholder="暗証番号を入力" autofocus="autofocus" />
				<a href="#" data-role="button" data-inline="true" data-transition="flow" data-theme="b" id="btnOrder" class="btn_next" onclick="eqPass();"><span id="btnOrderMoji">購入する</span></a>
				<a href="#" data-role="button" data-inline="true" data-rel="back" data-theme="c" id="popupClose" onclick="javascript:setLocalStorage(storage, 'purchased_item_flg', '');">閉じる</a>
				<div class="txt" style="margin-top: 30px;">
					<p><a href="passcode_hint.html" data-ajax="false">暗証番号を忘れた方はコチラ</a><p>
				</div>
			</div>
		</div>

	</body>
</html>